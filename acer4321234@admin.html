<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Control | Paradox Studio</title>
    <link rel="icon" type="image/png" href="icon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;800&family=JetBrains+Mono:wght@400;700&display=swap');
        body { background: #010409; font-family: 'Plus Jakarta Sans', sans-serif; color: white; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 32px; }
        .card-vip { border-left: 4px solid #eab308; }
        .card-system { border-left: 4px solid #3b82f6; }
        
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
    </style>
</head>
<body class="p-6 md:p-10">

    <header class="glass p-8 mb-10 flex justify-between items-center border-b border-blue-500/20">
        <div class="flex items-center gap-4">
            <img src="icon.png" class="w-14 h-14 rounded-2xl shadow-xl">
            <div>
                <h1 class="text-2xl font-black italic uppercase">Master <span class="text-blue-500">Admin</span></h1>
                <p class="text-[10px] mono text-gray-500 uppercase tracking-widest">Local Access: Authorized</p>
            </div>
        </div>
        <div class="text-right">
            <p id="timer" class="text-xl font-bold mono text-blue-500">00:00:00</p>
            <p class="text-[9px] text-gray-600 uppercase">Real-time Database: Active</p>
        </div>
    </header>

    <div class="grid lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-2 space-y-8">
            
            <div class="glass p-8 card-vip">
                <h3 class="text-xl font-black uppercase italic mb-6 text-yellow-500"><i class="fas fa-money-bill-wave mr-2"></i> Pending VIP Requests</h3>
                <div class="overflow-x-auto min-h-[200px]">
                    <table class="w-full text-left text-sm">
                        <thead class="text-[10px] text-gray-500 uppercase border-b border-white/5">
                            <tr>
                                <th class="pb-4">User ID</th>
                                <th class="pb-4">Gmail Address</th>
                                <th class="pb-4">TRX ID</th>
                                <th class="pb-4 text-right">Action</th>
                            </tr>
                        </thead>
                        <tbody id="vipRequestList">
                            </tbody>
                    </table>
                </div>
            </div>

            <div class="glass p-8 card-system">
                <h3 class="text-xl font-black uppercase italic mb-6 text-blue-500"><i class="fas fa-users mr-2"></i> User Directory</h3>
                <div class="overflow-x-auto min-h-[300px]">
                    <table class="w-full text-left text-sm">
                        <thead class="text-[10px] text-gray-500 uppercase border-b border-white/5">
                            <tr>
                                <th class="pb-4">Username</th>
                                <th class="pb-4">Full Name</th>
                                <th class="pb-4">Rank</th>
                                <th class="pb-4 text-right">Ops</th>
                            </tr>
                        </thead>
                        <tbody id="userListBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="space-y-8">
            <div class="glass p-8">
                <h3 class="text-lg font-bold mb-6 uppercase text-blue-400 italic">Quick Promote</h3>
                <input type="text" id="promoId" placeholder="Enter Username" class="w-full p-4 bg-black/40 border border-white/10 rounded-2xl text-xs mb-4 outline-none focus:border-blue-500">
                <button id="btnQuickVip" class="w-full py-4 bg-blue-600 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-blue-500 transition">Authorize VIP Node</button>
            </div>

            <div class="glass p-8">
                <h3 class="text-lg font-bold mb-6 uppercase text-gray-400 italic">Official Relay</h3>
                <div class="space-y-4">
                    <input type="text" id="msgTarget" placeholder="Target ID" class="w-full p-4 bg-black/40 border border-white/10 rounded-2xl text-xs outline-none">
                    <input type="text" id="msgSub" placeholder="Subject" class="w-full p-4 bg-black/40 border border-white/10 rounded-2xl text-xs outline-none">
                    <textarea id="msgBody" rows="4" placeholder="Message content..." class="w-full p-4 bg-black/40 border border-white/10 rounded-2xl text-xs outline-none resize-none"></textarea>
                    <button id="btnSendMsg" class="w-full py-4 bg-white text-black rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-blue-500 hover:text-white transition">Send Official Mail</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, push, update, get, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBJ19zQAzBoqrr-_wS0YRpNeKv4qjDFsVE",
            authDomain: "paradox-mail-official.firebaseapp.com",
            databaseURL: "https://paradox-mail-official-default-rtdb.firebaseio.com",
            projectId: "paradox-mail-official",
            storageBucket: "paradox-mail-official.firebasestorage.app",
            messagingSenderId: "249590854132",
            appId: "1:249590854132:web:27e6b3535d0e2dd850c9a1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // 1. LISTEN FOR VIP REQUESTS
        onValue(ref(db, 'paradox_ecosystem/vip_requests'), (snapshot) => {
            const list = document.getElementById('vipRequestList');
            list.innerHTML = "";
            if(snapshot.exists()){
                const reqs = snapshot.val();
                for(let key in reqs){
                    const r = reqs[key];
                    list.innerHTML += `
                        <tr class="border-b border-white/5 hover:bg-white/[0.02]">
                            <td class="py-4 font-bold text-yellow-500">@${r.username}</td>
                            <td class="py-4 text-gray-400 text-xs">${r.gmail}</td>
                            <td class="py-4 mono text-blue-400 text-[10px]">${r.trxID}</td>
                            <td class="py-4 text-right">
                                <button onclick="approveVip('${r.username}', '${key}')" class="bg-yellow-600 text-black px-3 py-1 rounded-lg text-[10px] font-bold uppercase">Approve</button>
                            </td>
                        </tr>
                    `;
                }
            } else {
                list.innerHTML = "<tr><td colspan='4' class='py-10 text-center text-gray-600 italic'>No pending requests</td></tr>";
            }
        });

        // 2. LISTEN FOR USERS
        onValue(ref(db, 'paradox_ecosystem/users'), (snapshot) => {
            const body = document.getElementById('userListBody');
            body.innerHTML = "";
            if(snapshot.exists()){
                const users = snapshot.val();
                for(let id in users){
                    const u = users[id];
                    body.innerHTML += `
                        <tr class="border-b border-white/5">
                            <td class="py-4 font-bold text-blue-400">@${id}</td>
                            <td class="py-4 text-gray-400">${u.fullName}</td>
                            <td class="py-4">
                                <span class="text-[9px] font-bold px-2 py-1 rounded ${u.rank === 'VIP' ? 'bg-yellow-500/10 text-yellow-500' : 'bg-blue-500/10 text-blue-500'}">${u.rank || 'Standard'}</span>
                            </td>
                            <td class="py-4 text-right">
                                <button onclick="deleteUser('${id}')" class="text-gray-700 hover:text-red-500"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>
                    `;
                }
            }
        });

        // 3. APPROVE VIP FUNCTION
        window.approveVip = async (username, reqKey) => {
            if(confirm(`Approve VIP for ${username}?`)) {
                try {
                    // Update user rank
                    await update(ref(db, `paradox_ecosystem/users/${username}`), {
                        rank: "VIP",
                        identity: username + ".paradox.pk"
                    });
                    // Delete the request
                    await remove(ref(db, `paradox_ecosystem/vip_requests/${reqKey}`));
                    // Send welcome mail
                    await push(ref(db, `paradox_ecosystem/mails/${username}`), {
                        senderID: "OFFICIAL",
                        senderName: "Paradox Studio",
                        subject: "ðŸ‘‘ VIP Activated",
                        body: "Congratulations! Your VIP identity node has been activated successfully.",
                        timestamp: Date.now(),
                        isNew: true
                    });
                    alert("User promoted and notified!");
                } catch(e) { alert("Error!"); }
            }
        };

        // 4. QUICK PROMOTE
        document.getElementById('btnQuickVip').onclick = async () => {
            const id = document.getElementById('promoId').value.trim().toLowerCase();
            if(!id) return;
            await update(ref(db, `paradox_ecosystem/users/${id}`), { rank: "VIP", identity: id + ".paradox.pk" });
            alert("Promoted!");
        };

        // 5. DELETE USER
        window.deleteUser = async (id) => {
            if(confirm(`Purge user @${id}?`)) {
                await remove(ref(db, `paradox_ecosystem/users/${id}`));
                alert("Deleted.");
            }
        }

        // CLOCK
        setInterval(() => { document.getElementById('timer').innerText = new Date().toLocaleTimeString('en-GB'); }, 1000);
    </script>
</body>
</html>
